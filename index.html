<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Interactivo - Percepci√≥n Social Paracel</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="style.css?v=4">
</head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<!-- Data -->
<script src="data.js?v=5"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
</head>

<body>

    <!-- PANTALLA DE LOGIN -->
    <div id="login-screen" class="glass-container">
        <div class="login-box">
            <img src="LOGO_PARA_FONDO_NEGRO.png" alt="Logo Paracel" class="logo-login">
            <h2>Acceso al Dashboard</h2>
            <p>Monitoreo de Impacto Social</p>
            <div class="input-group">
                <input type="text" id="username" placeholder="Usuario" autocomplete="off">
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="Contrase√±a">
            </div>
            <p id="login-error" class="error-msg" style="display: none;">Credenciales incorrectas.</p>
            <button id="btn-login" class="btn-primary">Ingresar</button>
        </div>
    </div>

    <!-- PANTALLA DEL DASHBOARD (Oculta por defecto) -->
    <div id="dashboard-screen" style="display: none;">

        <!-- NAVBAR -->
        <nav class="navbar glass-navbar">
            <div class="nav-left">
                <img src="LOGO_PARA_FONDO_NEGRO.png" alt="Logo Paracel" class="logo-nav">
                <h1>Monitoreo de Percepci√≥n (2022 - 2024)</h1>
            </div>
            <div class="nav-right" style="display:flex; align-items:center; gap:15px;">
                <span id="total-encuestas" style="font-weight:bold;">Total Encuestas: 0</span>
                <button id="btn-theme" class="btn-outline" style="padding:5px 10px; font-size:12px; cursor:pointer;"
                    title="Cambiar a Modo Oscuro">üåô Dark</button>
                <button id="btn-export" class="btn-outline" style="padding:5px 10px; font-size:12px;">Exportar
                    PNG</button>
                <button id="btn-logout" class="btn-secondary" style="padding:5px 10px; font-size:12px;">Cerrar
                    Sesi√≥n</button>
            </div>
        </nav>

        <div class="main-layout">
            <!-- SIDEBAR FILTROS -->
            <aside class="sidebar glass-panel">
                <h3>Filtros Din√°micos</h3>
                <p class="filter-instructions">Selecciona uno o m√°s botones para filtrar los datos.</p>

                <button id="btn-reset" class="btn-outline" style="margin-bottom: 20px; width: 100%;">Restablecer
                    Todos</button>

                <div class="filter-group">
                    <label title="A√≠sla personas que respondieron encuestas en m√∫ltiples a√±os.">
                        Tipo de Muestra <span style="cursor:help; color:var(--paracel-blue);"
                            title="S√≠ = Panelistas a lo largo del tiempo. No = Encuestados √∫nicos. Todos = Sin filtro.">(i)</span>
                    </label>
                    <div class="filter-buttons" id="filter-muestra"></div>
                </div>

                <div class="filter-group">
                    <label title="Clasificaci√≥n autom√°tica en cruce de P23 y P25">
                        Percepci√≥n General <span style="cursor:help; color:var(--paracel-blue);"
                            title="Clasifica seg√∫n menciones directas en aspectos positivos y barreras.">(i)</span>
                    </label>
                    <div class="filter-buttons" id="filter-percepcion"></div>
                </div>

                <div class="filter-group">
                    <label title="Filtra los resultados por la ola de ejecuci√≥n.">
                        A√±o de la Ola <span style="cursor:help; color:var(--paracel-blue);"
                            title="Selecciona uno con clic simple. Selecciona m√∫ltiples a la vez manteniendo presionada la tecla CTRL.">(i)</span>
                    </label>
                    <div class="filter-buttons" id="filter-anio"></div>
                </div>

                <div class="filter-group">
                    <label>G√©nero</label>
                    <div class="filter-buttons" id="filter-genero"></div>
                </div>

                <div class="filter-group">
                    <label>Rango de Edad</label>
                    <div class="filter-buttons" id="filter-edad"></div>
                </div>

                <div class="filter-group">
                    <label>Nivel Socioecon√≥mico (NSE)</label>
                    <div class="filter-buttons" id="filter-nse"></div>
                </div>

                <div class="filter-group">
                    <label>Comunidad</label>
                    <div class="filter-buttons" id="filter-comunidad"></div>
                </div>
            </aside>

            <!-- ZONA DE PESTA√ëAS Y GRAFICOS -->
            <main class="dashboard-content">

                <!-- KPI HEADER -->
                <div class="kpi-header" style="display:flex; gap:15px; margin-bottom:20px;">
                    <div class="kpi-card"
                        style="flex:1; background:var(--glass-bg); padding:15px; border-radius:8px; border:1px solid var(--glass-border); border-left:4px solid var(--accent); box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                        <h4 style="margin:0; font-size:12px; color:var(--text-sec); text-transform:uppercase;">Encuestas
                            Efectivas (N)</h4>
                        <p id="kpi-total" style="margin:5px 0 0; font-size:24px; font-weight:700; color:var(--accent);">
                            -</p>
                    </div>
                    <div class="kpi-card"
                        style="flex:1; background:var(--glass-bg); padding:15px; border-radius:8px; border:1px solid var(--glass-border); border-left:4px solid var(--paracel-blue); box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                        <h4 style="margin:0; font-size:12px; color:var(--text-sec); text-transform:uppercase;">
                            Percepci√≥n Positiva a Paracel</h4>
                        <p id="kpi-positiva"
                            style="margin:5px 0 0; font-size:24px; font-weight:700; color:var(--paracel-blue);">-</p>
                    </div>
                    <div class="kpi-card"
                        style="flex:1; background:var(--glass-bg); padding:15px; border-radius:8px; border:1px solid var(--glass-border); border-left:4px solid #ef4444; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                        <h4 style="margin:0; font-size:12px; color:var(--text-sec); text-transform:uppercase;">Top #1
                            Problema</h4>
                        <p id="kpi-problema"
                            style="margin:5px 0 0; font-size:16px; font-weight:700; color:#ef4444; line-height:1.2;">-
                        </p>
                    </div>
                    <div class="kpi-card"
                        style="flex:1; background:var(--glass-bg); padding:15px; border-radius:8px; border:1px solid var(--glass-border); border-left:4px solid var(--orange-accent); box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                        <h4 style="margin:0; font-size:12px; color:var(--text-sec); text-transform:uppercase;">Top #1
                            Atributo Lider</h4>
                        <p id="kpi-atributo"
                            style="margin:5px 0 0; font-size:16px; font-weight:700; color:var(--orange-accent); line-height:1.2;">
                            -</p>
                    </div>
                </div>

                <!-- TABS NAV -->
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="tab-comunidad">1. Comunidad</button>
                    <button class="tab-btn" data-tab="tab-paracel">2. F√°brica y Comunicaci√≥n</button>
                    <button class="tab-btn" data-tab="tab-perfil">3. Perfil Demogr√°fico</button>
                    <button class="tab-btn" data-tab="tab-evolucion"
                        style="color:var(--orange-accent); font-weight:800;">4. Evoluci√≥n Clave (2022-2025)</button>
                    <button class="tab-btn" data-tab="tab-datos">5. Base de Datos</button>
                    <button class="tab-btn" data-tab="tab-metodologia">6. Metodolog√≠a</button>
                </div>

                <!-- TAB 1: COMUNIDAD -->
                <div class="tab-content active" id="tab-comunidad">
                    <h2 class="tab-title">Percepci√≥n de la Comunidad</h2>
                    <div class="charts-row">
                        <div class="chart-container glass-panel" style="flex: 100%; max-width: 100%;">
                            <h3 title="P2: Comunidad (Distribuci√≥n de la Muestra)">Distribuci√≥n por Comunidades
                                Encuestadas <span style="cursor:help;"
                                    title="P2: Comunidad (Georeferenciaci√≥n)">(i)</span></h3>
                            <div class="canvas-wrapper"><canvas id="chartComunidades"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P2:</strong> Mapeo de comunidades de residencia de los encuestados.
                            </p>
                        </div>
                    </div>
                    <div class="charts-row">
                        <div class="chart-container glass-panel">
                            <h3
                                title="P15: ¬øCu√°les son los principales aspectos positivos de vivir en tu ciudad/ comunidad?">
                                Aspectos Positivos de la Comunidad <span style="cursor:help;"
                                    title="P15: ¬øCu√°les son los principales aspectos positivos de vivir en tu ciudad/ comunidad?">(i)</span>
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartPositivos"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P15:</strong> ¬øCu√°les son los principales aspectos positivos de vivir en tu
                                ciudad/ comunidad?
                            </p>
                        </div>
                    </div>
                    <div class="charts-row">
                        <div class="chart-container glass-panel">
                            <h3
                                title="P16: ¬øCu√°les son los principales problemas identificados en tu ciudad/comunidad?">
                                Problemas / Aspectos Negativos <span style="cursor:help;"
                                    title="P16: ¬øCu√°les son los principales problemas identificados en tu ciudad/comunidad?">(i)</span>
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartNegativos"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P16:</strong> ¬øCu√°les son los principales problemas identificados en tu
                                ciudad/comunidad?
                            </p>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: PARACEL Y COMUNICACION -->
                <div class="tab-content" id="tab-paracel" style="display: none;">
                    <h2 class="tab-title">Percepci√≥n sobre Paracel</h2>
                    <div class="charts-row">
                        <div class="chart-container glass-panel">
                            <h3
                                title="P23: ¬øQu√© aspectos positivos ya viste en tu ciudad/comunidad desde que empez√≥ la construcci√≥n de Paracel?">
                                Expectativas Positivas sobre la F√°brica <span style="cursor:help;"
                                    title="P23: ¬øQu√© aspectos positivos ya viste en tu ciudad/comunidad desde que empez√≥ la construcci√≥n de Paracel?">(i)</span>
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartExpectativas"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P23:</strong> ¬øQu√© aspectos positivos ya viste en tu ciudad/comunidad desde que
                                empez√≥ la construcci√≥n de Paracel?
                            </p>
                        </div>
                        <div class="chart-container glass-panel">
                            <h3 title="P25: ¬øCrees que hay alg√∫n aspecto negativo en el proyecto de Paracel? ¬øCu√°les?">
                                Temores /
                                Preocupaciones sobre la F√°brica (General) <span style="cursor:help;"
                                    title="P25: ¬øCrees que hay alg√∫n aspecto negativo en el proyecto de Paracel? ¬øCu√°les?">(i)</span>
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartTemores"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P25:</strong> ¬øCrees que hay alg√∫n aspecto negativo en el proyecto de Paracel?
                                ¬øCu√°les?
                            </p>
                        </div>
                    </div>
                    <div class="charts-row">
                        <div class="chart-container glass-panel">
                            <h3
                                title="P20: ¬øA trav√©s de qu√© medio/s te enteraste sobre la empresa de producci√≥n de celulosa Paracel?">
                                Recepci√≥n de Informaci√≥n (Medios) <span style="cursor:help;"
                                    title="P20: ¬øA trav√©s de qu√© medio/s te enteraste sobre la empresa de producci√≥n de celulosa Paracel?">(i)</span>
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartMedios"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P20:</strong> ¬øA trav√©s de qu√© medio/s te enteraste sobre la empresa de
                                producci√≥n de celulosa Paracel?
                            </p>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: PERFIL DEMOGRAFICO -->
                <div class="tab-content" id="tab-perfil" style="display: none;">
                    <h2 class="tab-title">Perfil Sociodemogr√°fico</h2>

                    <div class="charts-row">
                        <div class="chart-container glass-panel">
                            <h3 title="P7: ¬øCu√°l es tu nivel de estudios?">Nivel de Estudios <span
                                    style="cursor:help; color:var(--paracel-blue);"
                                    title="P7: ¬øCu√°l es tu nivel de estudios?">(i)</span></h3>
                            <div class="canvas-wrapper" style="min-height: 350px;"><canvas id="chartEstudios"></canvas>
                            </div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P7:</strong> ¬øCu√°l es tu nivel de estudios?
                            </p>
                        </div>
                        <div class="chart-container glass-panel">
                            <h3 title="P10: ¬øCu√°l es tu ocupaci√≥n actual?">Situaci√≥n Laboral <span
                                    style="cursor:help; color:var(--paracel-blue);"
                                    title="P10: ¬øCu√°l es tu ocupaci√≥n actual?">(i)</span></h3>
                            <div class="canvas-wrapper" style="min-height: 350px;"><canvas id="chartTrabajo"></canvas>
                            </div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P10:</strong> ¬øCu√°l es tu ocupaci√≥n actual?
                            </p>
                        </div>
                    </div>

                    <div class="charts-row">
                        <div class="chart-container glass-panel">
                            <h3 title="P8: ¬øCu√°l es el ingreso mensual familiar en tu hogar?">Ingresos Familiares
                                (Series Interanuales) <span style="cursor:help;"
                                    title="P8: ¬øCu√°l es el ingreso mensual familiar en tu hogar?">(i)</span>
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartIngresos"></canvas></div>
                            <p class="chart-note" style="font-size:11px; color:var(--text-sec); margin-top:10px;">
                                <strong>P8:</strong> ¬øCu√°l es el ingreso mensual familiar en tu hogar?
                            </p>
                        </div>
                    </div>

                </div> <!-- Fin Tab 3 -->

                <!-- TAB 4: EVOLUCION -->
                <div class="tab-content" id="tab-evolucion" style="display: none;">
                    <h2 class="tab-title" style="color:var(--accent); border-bottom-color:var(--orange-accent);">
                        Indicadores Evolutivos Clave (2022-2025)</h2>
                    <p style="color:var(--text-sec); font-size:14px; margin-bottom:15px;">
                        Estos gr√°ficos muestran los cambios m√°s significativos en la percepci√≥n y situaci√≥n de las
                        comunidades a trav√©s del tiempo. Se recomienda visualizar con todos los a√±os seleccionados
                        (marcando con la tecla CTRL).
                    </p>

                    <div class="charts-row">
                        <div class="chart-container">
                            <h3 title="Tendencia de favorabilidad a lo largo de los a√±os">1. Percepci√≥n Positiva de
                                Paracel (%)</h3>
                            <div class="canvas-wrapper"><canvas id="chartEvolPositiva"></canvas></div>
                            <p class="chart-note">Interpretaci√≥n: Curva hist√≥rica que visualiza el pico de aceptaci√≥n y
                                desgaste de expectativas (l√≠nea).</p>
                        </div>
                        <div class="chart-container">
                            <h3 title="El problema cr√≠tico en constante crecimiento">2. Falta de Oferta Laboral como
                                Problema (%)</h3>
                            <div class="canvas-wrapper"><canvas id="chartEvolFaltaLaboral"></canvas></div>
                            <p class="chart-note">Interpretaci√≥n: Preocupaci√≥n comunitaria constante por el empleo local
                                vs avances del proyecto (barras).</p>
                        </div>
                    </div>

                    <div class="charts-row">
                        <div class="chart-container">
                            <h3 title="Cambio en atributos l√≠deres de las comunidades">3. Atributos: Tranquilidad vs La
                                Gente</h3>
                            <div class="canvas-wrapper"><canvas id="chartEvolAtributos"></canvas></div>
                            <p class="chart-note">Interpretaci√≥n: Desplazamiento de "La tranquilidad" por "La gente"
                                como aspecto m√°s valorado (barras agrupadas).</p>
                        </div>
                        <div class="chart-container">
                            <h3 title="Reducci√≥n del desconocimiento 'No sabe' vs 'Celulosa/Eucalipto'">4.
                                Desconocimiento vs Comprensi√≥n</h3>
                            <div class="canvas-wrapper"><canvas id="chartEvolProduccion"></canvas></div>
                            <p class="chart-note">Interpretaci√≥n: Reducci√≥n del "NS/NR" sobre la producci√≥n a favor del
                                "Eucalipto/Celulosa" (√°reas/barras).</p>
                        </div>
                    </div>

                    <div class="charts-row">
                        <div class="chart-container">
                            <h3 title="Creaci√≥n de puestos vs Mejoras en caminos">5. Beneficios vs Expectativas Reales
                            </h3>
                            <div class="canvas-wrapper"><canvas id="chartEvolBeneficios"></canvas></div>
                            <p class="chart-note">Interpretaci√≥n: Ca√≠da en percepci√≥n de nuevos empleos contra un
                                aparente aumento en valoraci√≥n infraestructural (l√≠nea).</p>
                        </div>
                        <div class="chart-container">
                            <h3 title="Fuentes de informaci√≥n dominantes">6. Canales de Comunicaci√≥n Relevantes</h3>
                            <div class="canvas-wrapper"><canvas id="chartEvolCanales"></canvas></div>
                            <p class="chart-note">Interpretaci√≥n: Crecimiento de canales directos y digitales frente a
                                rumores (barras apiladas o sectores).</p>
                        </div>
                    </div>
                </div> <!-- Fin Tab 4 -->

                <!-- TAB 5: BASE DE DATOS -->
                <div class="tab-content" id="tab-datos">
                    <h2 class="tab-title" style="display:flex; justify-content:space-between; align-items:center;">
                        Base de Datos Interactiva
                        <button id="btn-export-csv" class="btn-outline"
                            style="font-size:12px; padding:6px 12px; margin:0; cursor:pointer;">‚¨á Exportar CSV</button>
                    </h2>
                    <div class="glass-panel" style="overflow-x: auto; max-height: 60vh; padding: 0;">
                        <table class="data-table" id="main-data-table"
                            style="width: 100%; border-collapse: collapse; text-align: left;">
                            <thead style="background: var(--surface-bg); position: sticky; top: 0; z-index: 10;">
                                <tr id="table-head-row"></tr>
                            </thead>
                            <tbody id="table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB 6: METODOLOG√çA -->
                <div class="tab-content" id="tab-metodologia">
                    <h2 class="tab-title">Metodolog√≠a y Alcance</h2>
                    <div class="glass-panel" style="line-height: 1.6; color: var(--text-sec);">
                        <h3 style="color: var(--text); margin-top:0;">Objetivo del Tablero</h3>
                        <p>Este Dashboard interactivo consolida los resultados del programa de Monitoreo de Percepci√≥n
                            Social de Paracel abarcando los a√±os 2022, 2023, 2024 y 2025.</p>

                        <h3 style="color: var(--text);">Procesamiento de Datos</h3>
                        <p>Los datos primarios provienen de encuestas en terreno estructuradas por cuestionarios
                            transversales. Para el presente tablero, se unificaron variables demogr√°ficas (NSE,
                            Comunidad, Edad, G√©nero) y preguntas de percepci√≥n abierta, estandarizando problem√°ticas y
                            beneficios mediante limpieza algor√≠tmica.</p>
                        <ul>
                            <li><strong>Encuestas Efectivas (N):</strong> Representa el conteo absoluto de registros
                                v√°lidos filtrados sobre el universo total de la muestra hist√≥rica.</li>
                            <li><strong>Panel / Recurrencia:</strong> Identifica individuos contactados en m√°s de un a√±o
                                consecutivo mediante cruce difuso de sus n√∫meros de tel√©fono y nombres de pila,
                                permitiendo detectar tendencias longitudinales puras.</li>
                            <li><strong>Imputaci√≥n de Variables Faltantes:</strong> Las celdas nulas en variables
                                cr√≠ticas como el "G√©nero" en bases de datos antiguas fueron reparadas cruzando
                                diccionarios de onom√°stica latina y terminaciones heur√≠sticas contra los Nombres
                                propios.</li>
                        </ul>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- JS -->
    <script src="script.js?v=8"></script>
</body>

</html>